<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>강의등록</title>
    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/common.css">
</head>

<body>
    <div class="container">
        <h2>강의등록</h2>
        <div class="upload-container">
            <form class="col-md-6 logpad">
                <div class="form-group">
                    <label for="major">개설학과</label>
                    <input type="text" class="form-control" id="major">
                </div>
                <div class="form-group">
                    <label for="name">강의명</label>
                    <input type="text" class="form-control" id="name">
                </div>
                <div class="form-group">
                    <label for="purpose">강의내용</label>
                    <textarea type="text" class="form-control" id="content" rows="10" cols="25"></textarea>
                </div>
                <div class="form-group">
                    <label for="capacity">정원</label>
                    <input type="number" class="form-control" id="capacity">
                </div>
                <label>강의계획서</label>
                <div class="input-group mb-3">
                    <div class="custom-file">
                        <input type="file" class="custom-file-input" id="syllabus" name="file" data-url="../json/lecture/insert" multiple>
                        <label class="custom-file-label" for="syllabus">파일선택</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="room">강의실</label>
                    <input type="text" class="form-control" id="room">
                </div>
                <div class="form-group">
                    <label for="startdate">시작일</label>
                    <input type="date" class="form-control" id="startdate">
                </div>
                <div class="form-group">
                    <label for="enddate">종료일</label>
                    <input type="date" class="form-control" id="enddate">
                </div>
                <div class="form-group">
                    <label for="time">강의시간</label>
                    <input type="time" class="form-control" id="time">
                </div>
                <hr>
                <button type="button" id="regClsBtn" class="btn btn-primary" style="width: 100%">강의등록</button>
            </form>
        </div>
    </div>
    <script src="../node_modules/jquery/dist/jquery.min.js"></script>
    <script src="../node_modules/popper.js/dist/umd/popper.min.js"></script>
    <script src="../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="../node_modules/sweetalert/dist/sweetalert.min.js"></script>
    <script src="../node_modules/blueimp-file-upload/js/vendor/jquery.ui.widget.js"></script>
    <script src="../node_modules/blueimp-file-upload/js/jquery.iframe-transport.js"></script>
    <script src="../node_modules/blueimp-file-upload/js/jquery.fileupload.js"></script>
    <script>
        let filename;

        $('#syllabus').fileupload({
            dataType: 'json',
            done: function (e, data) {
                console.log('done()...');
                console.log(data.result.newfilename);
                filename = data.result.newfilename;
            }
        });

        $('#regClsBtn').click(function () {

            if (!$(major).val() || $(major).val() == "") {
                swal("개설학과를 입력하세요!");
                return;
            }

            if (!$('#name').val() || $('#name').val() == "") {
                swal("강좌명을 입력하세요!");
                return;
            }

            if (!$(content).val() || $(content).val() == "") {
                swal("강의 내용을 입력해 주세요!");
                return;
            }

            if (!$(capacity).val() || $(capacity).val() == "") {
                swal("수용인원을 입력해 주세요!");
                return;
            }

            if (!$(room).val() || $(room).val() == "") {
                swal("강의실을 입력해 주세요!");
                return;
            }

            if (!$(startdate).val() || $(startdate).val() == "") {
                swal("시작일을 입력해 주세요!");
                return;
            }

            if (!$(enddate).val() || $(enddate).val() == "") {
                swal("종료일을 입력해 주세요!");
                return;
            }

            $.ajax('../json/lecture/add', {
                method: 'POST',
                dataType: 'json',
                data: {
                    pNum: 2,
                    lectureSubject: $(major).val(),
                    lectureName: $('#name').val(),
                    lectureContent: $(content).val(),
                    lectureMaxMember: $(capacity).val(),
                    lectureFile: filename,
                    lectureRoom: $(room).val(),
                    lectureStartDay: $(startdate).val(),
                    lectureEndDay: $(enddate).val(),
                    //lectureTime: $(time).val()
                },
                success: function (data) {
                    if (!data.err) {
                        swal("성공입니다!");
                        location.href = 'Lecture/list.html';
                    } else {
                        swal("오류발생",
                            "알 수 없는 원인에 의해 오류가 발생 했습니다. 잠시 후 다시 시도해주세요. 오류가 지속된다면 고객지원센터로 문의 바랍니다."
                        );
                        console.log(data.error);
                    }
                }
            });
        });
    </script>
</body>

</html>